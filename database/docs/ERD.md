# ğŸ“Š Diagrama Entidad-RelaciÃ³n (ERD) - CELAEST

## VisiÃ³n General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    CELAEST ERD                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   SUPABASE AUTH     â”‚
                              â”‚   (auth.users)      â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                              â”‚  â”‚ id (UUID) PK  â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  â”‚ email         â”‚  â”‚                          â”‚
                              â”‚  â”‚ created_at    â”‚  â”‚                          â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                                                                               â”‚
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•
    POSTGRESQL LOCAL                                                           â”‚
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•
                                                                               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
    â”‚                         MÃ“DULO IDENTIDAD                                 â”‚â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                                                                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
         â”‚    organizations      â”‚              â”‚    users_profile      â”‚â—„â”€â”€â”€â”€â”€â”˜
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚ â€¢ id (PK)            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”‚ â€¢ id (PK) â•â•â•â•â•â•â•â•â•â•â•â”‚â•â•â• FK from Supabase
         â”‚ â€¢ name               â”‚             â”‚â”‚ â€¢ organization_id (FK)â”‚
         â”‚ â€¢ slug (UNIQUE)      â”‚             â”‚â”‚ â€¢ email (UNIQUE)     â”‚
         â”‚ â€¢ email              â”‚             â”‚â”‚ â€¢ first_name         â”‚
         â”‚ â€¢ settings (JSONB)   â”‚             â”‚â”‚ â€¢ last_name          â”‚
         â”‚ â€¢ max_users          â”‚             â”‚â”‚ â€¢ role (ENUM)        â”‚
         â”‚ â€¢ created_at         â”‚             â”‚â”‚ â€¢ scopes (JSONB)     â”‚
         â”‚ â€¢ deleted_at         â”‚             â”‚â”‚ â€¢ preferences (JSONB)â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                           â”‚          â”‚
                   â”‚ 1                         â”‚ N        â”‚
                   â”‚                           â”‚          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â”‚    MÃ“DULO LICENCIAS       â”‚          â”‚                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                           â”‚          â”‚
                   â–¼                           â”‚          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚          â”‚
    â”‚ subscription_plans    â”‚                  â”‚          â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚          â”‚
    â”‚ â€¢ id (PK)            â”‚                  â”‚          â”‚
    â”‚ â€¢ code (UNIQUE)      â”‚                  â”‚          â”‚
    â”‚ â€¢ name               â”‚â—„â”€â”€â”€â”€â”€â”€â”          â”‚          â”‚
    â”‚ â€¢ price_monthly      â”‚       â”‚          â”‚          â”‚
    â”‚ â€¢ price_yearly       â”‚       â”‚          â”‚          â”‚
    â”‚ â€¢ limits (JSONB)     â”‚       â”‚          â”‚          â”‚
    â”‚ â€¢ features (JSONB)   â”‚       â”‚ 1        â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚          â”‚          â”‚
                                   â”‚          â”‚          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
                   â”‚      licenses         â”‚  â”‚          â”‚
                   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚          â”‚
                   â”‚ â€¢ id (PK)            â”‚â”€â”€â”˜          â”‚
                   â”‚ â€¢ organization_id(FK)â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ â€¢ plan_id (FK)       â”‚              â”‚
                   â”‚ â€¢ license_key(UNIQUE)â”‚              â”‚
                   â”‚ â€¢ status (ENUM)      â”‚              â”‚
                   â”‚ â€¢ expires_at         â”‚              â”‚
                   â”‚ â€¢ ai_requests_used   â”‚              â”‚
                   â”‚ â€¢ custom_limits(JSON)â”‚              â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                             â”‚ 1                         â”‚
                             â”‚                           â”‚
                             â–¼                           â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
                   â”‚  license_usage_log    â”‚             â”‚
                   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
                   â”‚ â€¢ id (PK)            â”‚             â”‚
                   â”‚ â€¢ license_id (FK)    â”‚             â”‚
                   â”‚ â€¢ period_start       â”‚             â”‚
                   â”‚ â€¢ ai_requests_count  â”‚             â”‚
                   â”‚ â€¢ tokens_input       â”‚             â”‚
                   â”‚ â€¢ calculated_cost    â”‚             â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                                                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    MÃ“DULO IA-MESH (CEREBRO)       â”‚                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     ai_models         â”‚   â”‚    ai_api_pool        â”‚   â”‚   prompts_master      â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ â€¢ id (PK)            â”‚â—„â”€â”€â”‚ â€¢ id (PK)            â”‚   â”‚ â€¢ id (PK)            â”‚
    â”‚ â€¢ provider (ENUM)    â”‚   â”‚ â€¢ provider (ENUM)    â”‚   â”‚ â€¢ slug (UNIQUE)      â”‚
    â”‚ â€¢ model_id           â”‚   â”‚ â€¢ key_name           â”‚   â”‚ â€¢ name               â”‚
    â”‚ â€¢ display_name       â”‚   â”‚ â€¢ key_encrypted      â”‚   â”‚ â€¢ category           â”‚
    â”‚ â€¢ capabilities(JSON) â”‚   â”‚ â€¢ is_active          â”‚   â”‚ â€¢ system_prompt      â”‚
    â”‚ â€¢ max_tokens_input   â”‚   â”‚ â€¢ is_healthy         â”‚   â”‚ â€¢ variables (JSONB)  â”‚
    â”‚ â€¢ cost_per_1k_input  â”‚   â”‚ â€¢ rate_limit_rpm     â”‚   â”‚ â€¢ preferred_model(FK)â”‚â—„â”€â”
    â”‚ â€¢ is_default         â”‚   â”‚ â€¢ usage_count        â”‚   â”‚ â€¢ temperature        â”‚  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â€¢ priority           â”‚   â”‚ â€¢ version            â”‚  â”‚
           â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â€¢ is_active          â”‚  â”‚
           â”‚                             â”‚                  â”‚ â€¢ parent_id (FK) â”€â”€â”€â”€â”‚â”€â”€â”¤
           â”‚                             â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
           â”‚                             â”‚                            â”‚                â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                          â”‚                                                            â”‚
                          â–¼                                                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
    â”‚                         MÃ“DULO OPERACIONES                                       â”‚â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                                                                                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
    â”‚    task_batches       â”‚                                                          â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                                          â”‚
    â”‚ â€¢ id (PK)            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
    â”‚ â€¢ organization_id(FK)â”‚              â”‚                                           â”‚
    â”‚ â€¢ user_id (FK)       â”‚              â”‚                                           â”‚
    â”‚ â€¢ status (ENUM)      â”‚              â”‚                                           â”‚
    â”‚ â€¢ total_tasks        â”‚              â”‚                                           â”‚
    â”‚ â€¢ completed_tasks    â”‚              â”‚ 1                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                                           â”‚
                                          â”‚                                           â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
                          â”‚          processed_tasks                  â”‚               â”‚
                          â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
                          â”‚ â€¢ id (PK)                                â”‚               â”‚
                          â”‚ â€¢ organization_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â–º organizationsâ”‚
                          â”‚ â€¢ user_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â–º users_profileâ”‚
                          â”‚ â€¢ license_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â–º licenses    â”‚
                          â”‚ â€¢ batch_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”˜           â”‚
                          â”‚ â€¢ model_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â–º ai_models   â”‚
                          â”‚ â€¢ api_key_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â–º ai_api_pool â”‚
                          â”‚ â€¢ prompt_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ â€¢ input_text                             â”‚
                          â”‚ â€¢ output_json (JSONB)                    â”‚
                          â”‚ â€¢ status (ENUM)                          â”‚
                          â”‚ â€¢ tokens_input                           â”‚
                          â”‚ â€¢ tokens_output                          â”‚
                          â”‚ â€¢ tokens_total (GENERATED)               â”‚
                          â”‚ â€¢ cost_usd                               â”‚
                          â”‚ â€¢ execution_time_ms                      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ Aggregated
                                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                            MÃ“DULO ANALYTICS                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚            roi_metrics                    â”‚
                          â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                          â”‚ â€¢ id (PK)                                â”‚
                          â”‚ â€¢ organization_id (FK)                   â”‚
                          â”‚ â€¢ period_type                            â”‚
                          â”‚ â€¢ period_start                           â”‚
                          â”‚ â€¢ tasks_completed                        â”‚
                          â”‚ â€¢ time_saved_minutes                     â”‚
                          â”‚ â€¢ money_saved                            â”‚
                          â”‚ â€¢ avg_execution_time_ms                  â”‚
                          â”‚ â€¢ active_users_count                     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                            MÃ“DULO AUDITORÃA                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     audit_logs        â”‚              â”‚   telemetry_events    â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ â€¢ id (PK)            â”‚              â”‚ â€¢ id (PK)            â”‚
    â”‚ â€¢ user_id (FK)       â”‚              â”‚ â€¢ organization_id(FK)â”‚
    â”‚ â€¢ organization_id(FK)â”‚              â”‚ â€¢ user_id (FK)       â”‚
    â”‚ â€¢ action (ENUM)      â”‚              â”‚ â€¢ event_type         â”‚
    â”‚ â€¢ resource_type      â”‚              â”‚ â€¢ event_name         â”‚
    â”‚ â€¢ resource_id        â”‚              â”‚ â€¢ properties (JSONB) â”‚
    â”‚ â€¢ changes (JSONB)    â”‚              â”‚ â€¢ page_url           â”‚
    â”‚ â€¢ ip_address         â”‚              â”‚ â€¢ device_type        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                            MÃ“DULO SISTEMA                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    system_config      â”‚              â”‚    feature_flags      â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ â€¢ key (PK)           â”‚              â”‚ â€¢ id (PK)            â”‚
    â”‚ â€¢ value (JSONB)      â”‚              â”‚ â€¢ flag_key (UNIQUE)  â”‚
    â”‚ â€¢ description        â”‚              â”‚ â€¢ is_enabled         â”‚
    â”‚ â€¢ is_sensitive       â”‚              â”‚ â€¢ target_type        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â€¢ target_percentage  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Relaciones Detalladas

### 1:N (Uno a Muchos)

| Tabla Padre | Tabla Hijo | FK Column | DescripciÃ³n |
|-------------|------------|-----------|-------------|
| `organizations` | `users_profile` | `organization_id` | Una org tiene muchos usuarios |
| `organizations` | `licenses` | `organization_id` | Una org tiene muchas licencias |
| `organizations` | `task_batches` | `organization_id` | Una org tiene muchos batches |
| `organizations` | `processed_tasks` | `organization_id` | Una org tiene muchas tareas |
| `organizations` | `roi_metrics` | `organization_id` | Una org tiene muchas mÃ©tricas |
| `subscription_plans` | `licenses` | `plan_id` | Un plan tiene muchas licencias |
| `licenses` | `license_usage_log` | `license_id` | Una licencia tiene muchos logs |
| `licenses` | `processed_tasks` | `license_id` | Una licencia tiene muchas tareas |
| `users_profile` | `task_batches` | `user_id` | Un usuario tiene muchos batches |
| `users_profile` | `processed_tasks` | `user_id` | Un usuario tiene muchas tareas |
| `task_batches` | `processed_tasks` | `batch_id` | Un batch tiene muchas tareas |
| `ai_models` | `processed_tasks` | `model_id` | Un modelo procesa muchas tareas |
| `ai_models` | `prompts_master` | `preferred_model_id` | Un modelo es preferido en muchos prompts |
| `ai_api_pool` | `processed_tasks` | `api_key_id` | Una API key procesa muchas tareas |
| `prompts_master` | `processed_tasks` | `prompt_id` | Un prompt se usa en muchas tareas |
| `prompts_master` | `prompts_master` | `parent_id` | Auto-referencia para versionado |

### Constraints Importantes

| Tabla | Constraint | Tipo | DescripciÃ³n |
|-------|-----------|------|-------------|
| `organizations` | `slug` | UNIQUE | URL-friendly identifier |
| `users_profile` | `email` | UNIQUE | Email Ãºnico en el sistema |
| `licenses` | `license_key` | UNIQUE | Token de licencia Ãºnico |
| `subscription_plans` | `code` | UNIQUE | CÃ³digo de plan Ãºnico |
| `ai_models` | `(provider, model_id)` | UNIQUE | Combo proveedor+modelo Ãºnico |
| `prompts_master` | `(slug, version)` | UNIQUE | Combo slug+versiÃ³n Ãºnico |
| `roi_metrics` | `(org_id, period_type, period_start)` | UNIQUE | Un registro por perÃ­odo |
| `license_usage_log` | `(license_id, period_start, period_end)` | UNIQUE | Un log por perÃ­odo |

---

## Cardinalidades

```
organizations â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º users_profile
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º licenses â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º license_usage_log
                  â”‚                    â”‚
                  â”‚                    â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º processed_tasks
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º task_batches â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º processed_tasks
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º roi_metrics
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º audit_logs
                  â”‚
                  â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º telemetry_events

subscription_plans â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º licenses

ai_models â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º processed_tasks
              â”‚
              â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º prompts_master (preferred_model)

ai_api_pool â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º processed_tasks

prompts_master â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º processed_tasks
                   â”‚
                   â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º prompts_master (parent, self-reference)

users_profile â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º task_batches
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º processed_tasks
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º audit_logs
                  â”‚
                  â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º telemetry_events
```

---

## Ãndices por Tabla

### Alta Prioridad (Hot Paths)

| Tabla | Ãndice | Columnas | Uso |
|-------|--------|----------|-----|
| `licenses` | `idx_licenses_key` | `license_key` | ValidaciÃ³n de licencia |
| `licenses` | `idx_licenses_status` | `status` | Filtro por activas |
| `processed_tasks` | `idx_tasks_org_created` | `(org_id, created_at)` | Dashboard |
| `users_profile` | `idx_users_profile_email` | `email` | Login |
| `ai_api_pool` | `idx_ai_api_pool_health` | `(is_healthy, priority)` | SelecciÃ³n de key |

### Media Prioridad

| Tabla | Ãndice | Columnas | Uso |
|-------|--------|----------|-----|
| `audit_logs` | `idx_audit_created_at` | `created_at` | BÃºsqueda temporal |
| `roi_metrics` | `idx_roi_org_period` | `(org_id, period_type, period_start)` | Reports |
| `telemetry_events` | `idx_telemetry_org` | `(org_id, created_at)` | Analytics |

---

## Notas de DiseÃ±o

1. **UUID como PK**: Compatibilidad con Supabase Auth y escalabilidad distribuida
2. **Soft Delete**: `deleted_at` en tablas crÃ­ticas para recovery
3. **JSONB**: Flexibilidad para datos semi-estructurados sin migraciones
4. **Generated Columns**: `tokens_total` calculado automÃ¡ticamente
5. **Partial Indexes**: Solo indexamos filas activas para mejor performance
6. **Self-Reference**: `prompts_master.parent_id` para tracking de evoluciÃ³n

---

## ğŸ†• MÃ“DULOS V002 (Extendidos)

### MÃ³dulo Marketplace/Assets

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MÃ“DULO MARKETPLACE                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  product_categories   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      products         â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ â€¢ id (PK)            â”‚â—„â”€â”€â”€â”€â”€â”€â”          â”‚ â€¢ id (PK)            â”‚
    â”‚ â€¢ name               â”‚       â”‚          â”‚ â€¢ category_id (FK)   â”‚â”€â”€â”€â”€â”€â”€â”
    â”‚ â€¢ slug (UNIQUE)      â”‚       â”‚          â”‚ â€¢ name               â”‚      â”‚
    â”‚ â€¢ parent_id (FK)     â”‚â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â€¢ slug (UNIQUE)      â”‚      â”‚
    â”‚ â€¢ sort_order         â”‚ self-ref         â”‚ â€¢ price              â”‚      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â€¢ status (ENUM)      â”‚      â”‚
                                              â”‚ â€¢ avg_rating         â”‚â—„â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ â€¢ review_count       â”‚      â”‚         â”‚
                                              â”‚ â€¢ download_count     â”‚      â”‚         â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚         â”‚
                                                        â”‚ 1                  â”‚         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚         â”‚
                              â–¼              â–¼                     â–¼        â”‚         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   product_reviews     â”‚ â”‚  product_releases     â”‚ â”‚ customer_assets â”‚
              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ â€¢ id (PK)            â”‚ â”‚ â€¢ id (PK)            â”‚ â”‚ â€¢ id (PK)      â”‚
              â”‚ â€¢ product_id (FK)    â”‚ â”‚ â€¢ product_id (FK)    â”‚ â”‚ â€¢ product_id(FK)â”‚
              â”‚ â€¢ user_id (FK)       â”‚ â”‚ â€¢ version            â”‚ â”‚ â€¢ user_id (FK) â”‚
              â”‚ â€¢ rating (1-5)       â”‚ â”‚ â€¢ status (ENUM)      â”‚ â”‚ â€¢ license_id(FK)â”‚
              â”‚ â€¢ title              â”‚ â”‚ â€¢ release_notes      â”‚ â”‚ â€¢ order_id (FK)â”‚
              â”‚ â€¢ comment            â”‚ â”‚ â€¢ download_url       â”‚ â”‚ â€¢ status (ENUM)â”‚
              â”‚ â€¢ is_verified        â”‚ â”‚ â€¢ checksum_sha256    â”‚ â”‚ â€¢ expires_at   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚ 1                     â”‚ 1
                                                  â–¼                       â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚   asset_downloads     â”‚
                                        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                                        â”‚ â€¢ id (PK)            â”‚
                                        â”‚ â€¢ asset_id (FK)      â”‚
                                        â”‚ â€¢ release_id (FK)    â”‚
                                        â”‚ â€¢ user_id (FK)       â”‚
                                        â”‚ â€¢ ip_address         â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MÃ³dulo Billing Extendido

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MÃ“DULO BILLING                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   payment_gateways    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      orders           â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ â€¢ id (PK)            â”‚                  â”‚ â€¢ id (PK)            â”‚
    â”‚ â€¢ name               â”‚                  â”‚ â€¢ order_number(UNIQ) â”‚
    â”‚ â€¢ code (UNIQUE)      â”‚                  â”‚ â€¢ user_id (FK)       â”‚
    â”‚ â€¢ provider           â”‚                  â”‚ â€¢ gateway_id (FK)    â”‚â”€â”€â”€â”€â”€â”€â”
    â”‚ â€¢ status (ENUM)      â”‚                  â”‚ â€¢ status (ENUM)      â”‚      â”‚
    â”‚ â€¢ fee_percentage     â”‚                  â”‚ â€¢ total              â”‚      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â€¢ coupon_id (FK)     â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚
                                                        â”‚ 1                  â”‚     â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
                              â–¼              â–¼                     â–¼        â”‚     â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”
              â”‚    order_items        â”‚ â”‚      invoices         â”‚ â”‚     coupons      â”‚
              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ â€¢ id (PK)            â”‚ â”‚ â€¢ id (PK)            â”‚ â”‚ â€¢ id (PK)      â”‚
              â”‚ â€¢ order_id (FK)      â”‚ â”‚ â€¢ invoice_number(UNQ)â”‚ â”‚ â€¢ code (UNIQUE)â”‚
              â”‚ â€¢ product_id (FK)    â”‚ â”‚ â€¢ order_id (FK)      â”‚ â”‚ â€¢ discount_typeâ”‚
              â”‚ â€¢ quantity           â”‚ â”‚ â€¢ user_id (FK)       â”‚ â”‚ â€¢ discount_val â”‚
              â”‚ â€¢ unit_price         â”‚ â”‚ â€¢ status (ENUM)      â”‚ â”‚ â€¢ valid_from   â”‚
              â”‚ â€¢ total              â”‚ â”‚ â€¢ total              â”‚ â”‚ â€¢ valid_until  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   payment_methods     â”‚                  â”‚      tax_rates        â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ â€¢ id (PK)            â”‚                  â”‚ â€¢ id (PK)            â”‚
    â”‚ â€¢ user_id (FK)       â”‚                  â”‚ â€¢ name               â”‚
    â”‚ â€¢ type (ENUM)        â”‚                  â”‚ â€¢ code (UNIQUE)      â”‚
    â”‚ â€¢ card_brand (ENUM)  â”‚                  â”‚ â€¢ rate               â”‚
    â”‚ â€¢ card_last4         â”‚                  â”‚ â€¢ country_code       â”‚
    â”‚ â€¢ is_default         â”‚                  â”‚ â€¢ is_active          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MÃ³dulo Settings Extendido

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MÃ“DULO SETTINGS                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    user_sessions      â”‚                  â”‚    user_api_keys      â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ â€¢ id (PK)            â”‚                  â”‚ â€¢ id (PK)            â”‚
    â”‚ â€¢ user_id (FK)       â”‚                  â”‚ â€¢ user_id (FK)       â”‚
    â”‚ â€¢ session_token(UNQ) â”‚                  â”‚ â€¢ name               â”‚
    â”‚ â€¢ ip_address         â”‚                  â”‚ â€¢ key_hash           â”‚
    â”‚ â€¢ user_agent         â”‚                  â”‚ â€¢ key_prefix         â”‚
    â”‚ â€¢ device_info (JSON) â”‚                  â”‚ â€¢ scopes (ARRAY)     â”‚
    â”‚ â€¢ is_active          â”‚                  â”‚ â€¢ rate_limit_rpm     â”‚
    â”‚ â€¢ expires_at         â”‚                  â”‚ â€¢ usage_count        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      webhooks         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  webhook_deliveries   â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ â€¢ id (PK)            â”‚ 1              N â”‚ â€¢ id (PK)            â”‚
    â”‚ â€¢ user_id (FK)       â”‚                  â”‚ â€¢ webhook_id (FK)    â”‚
    â”‚ â€¢ name               â”‚                  â”‚ â€¢ event_type         â”‚
    â”‚ â€¢ url                â”‚                  â”‚ â€¢ payload (JSONB)    â”‚
    â”‚ â€¢ secret_hash        â”‚                  â”‚ â€¢ response_status    â”‚
    â”‚ â€¢ events (ARRAY)     â”‚                  â”‚ â€¢ attempt_number     â”‚
    â”‚ â€¢ status (ENUM)      â”‚                  â”‚ â€¢ delivered_at       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MÃ³dulo Control de IP de Licencias

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MÃ“DULO IP CONTROL                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              licenses (V001)
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚           â”‚
        â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚license_ip_bindâ”‚ â”‚license_valida â”‚ â”‚  license_collisions   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id (PK)    â”‚ â”‚ â€¢ id (PK)    â”‚ â”‚ â€¢ id (PK)            â”‚
â”‚ â€¢ license_id â”‚ â”‚ â€¢ license_id â”‚ â”‚ â€¢ license_id (FK)    â”‚
â”‚ â€¢ ip_address â”‚ â”‚ â€¢ ip_binding â”‚ â”‚ â€¢ ip_binding_a (FK)  â”‚
â”‚ â€¢ machine_id â”‚ â”‚ â€¢ ip_address â”‚ â”‚ â€¢ ip_binding_b (FK)  â”‚
â”‚ â€¢ hostname   â”‚ â”‚ â€¢ is_valid   â”‚ â”‚ â€¢ collision_type     â”‚
â”‚ â€¢ is_active  â”‚ â”‚ â€¢ failure_rsnâ”‚ â”‚ â€¢ severity (ENUM)    â”‚
â”‚ â€¢ first_seen â”‚ â”‚ â€¢ created_at â”‚ â”‚ â€¢ resolved_at        â”‚
â”‚ â€¢ last_seen  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â€¢ auto_resolved      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â–¼
            Detecta uso simultÃ¡neo anÃ³malo
```

---

## Relaciones V002

### Nuevas FK (Uno a Muchos)

| Tabla Padre | Tabla Hijo | FK Column | DescripciÃ³n |
|-------------|------------|-----------|-------------|
| `product_categories` | `products` | `category_id` | Una categorÃ­a tiene muchos productos |
| `product_categories` | `product_categories` | `parent_id` | CategorÃ­as jerÃ¡rquicas |
| `products` | `product_reviews` | `product_id` | Un producto tiene muchas reviews |
| `products` | `product_releases` | `product_id` | Un producto tiene muchas versiones |
| `products` | `customer_assets` | `product_id` | Un producto tiene muchos assets |
| `users_profile` | `product_reviews` | `user_id` | Un usuario tiene muchas reviews |
| `users_profile` | `customer_assets` | `user_id` | Un usuario tiene muchos assets |
| `users_profile` | `payment_methods` | `user_id` | Un usuario tiene muchos mÃ©todos de pago |
| `users_profile` | `orders` | `user_id` | Un usuario tiene muchas Ã³rdenes |
| `users_profile` | `user_sessions` | `user_id` | Un usuario tiene muchas sesiones |
| `users_profile` | `user_api_keys` | `user_id` | Un usuario tiene muchas API keys |
| `users_profile` | `webhooks` | `user_id` | Un usuario tiene muchos webhooks |
| `licenses` | `customer_assets` | `license_id` | Una licencia tiene muchos assets |
| `licenses` | `license_ip_bindings` | `license_id` | Una licencia tiene muchas IPs |
| `licenses` | `license_validations` | `license_id` | Una licencia tiene muchas validaciones |
| `licenses` | `license_collisions` | `license_id` | Una licencia tiene muchas colisiones |
| `orders` | `order_items` | `order_id` | Una orden tiene muchos Ã­tems |
| `orders` | `invoices` | `order_id` | Una orden tiene muchas facturas |
| `orders` | `customer_assets` | `order_id` | Una orden genera assets |
| `webhooks` | `webhook_deliveries` | `webhook_id` | Un webhook tiene muchas entregas |
| `customer_assets` | `asset_downloads` | `asset_id` | Un asset tiene muchas descargas |
| `product_releases` | `asset_downloads` | `release_id` | Una release tiene muchas descargas |

---

## Cardinalidades V002

```
products â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º product_reviews
             â”‚
             â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º product_releases â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º asset_downloads
             â”‚
             â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º customer_assets â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º asset_downloads

product_categories â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º products
                       â”‚
                       â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º product_categories (self-ref)

users_profile â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º payment_methods
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º orders â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º order_items
                  â”‚                          â”‚
                  â”‚                          â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º invoices
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º user_sessions
                  â”‚
                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º user_api_keys
                  â”‚
                  â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º webhooks â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º webhook_deliveries

licenses â”€â”€â”€â”€â”¬â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º license_ip_bindings
             â”‚
             â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º license_validations
             â”‚
             â””â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º license_collisions

payment_gateways â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º orders

coupons â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â–º orders
```

---

## Resumen de Tablas

| MÃ³dulo | V001 (Core) | V002 (Extended) |
|--------|-------------|-----------------|
| Identity | `organizations`, `users_profile` | - |
| Licensing | `subscription_plans`, `licenses`, `license_usage_log` | - |
| IA-Mesh | `ai_models`, `ai_api_pool`, `prompts_master` | - |
| Operations | `task_batches`, `processed_tasks` | - |
| Analytics | `roi_metrics`, `telemetry_events` | - |
| Audit | `audit_logs`, `system_events` | - |
| System | `system_config`, `feature_flags` | - |
| Marketplace | - | `product_categories`, `products`, `product_reviews` |
| Releases | - | `product_releases`, `customer_assets`, `asset_downloads` |
| Billing | - | `payment_gateways`, `payment_methods`, `orders`, `order_items`, `invoices`, `tax_rates`, `coupons` |
| Settings | - | `user_sessions`, `user_api_keys`, `webhooks`, `webhook_deliveries` |
| IP Control | - | `license_ip_bindings`, `license_validations`, `license_collisions` |

**Total: 33 tablas**
